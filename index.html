<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Be A Barista</title>
    
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.0.4/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.3/dist/super-hands.min.js"></script>
    
    <script src="script.js"></script>

    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>

  <body>
    <a-scene background="color: #ECECEC"
      vr-mode-ui="enabled: true" webxr="optionalFeatures: local-floor, bounded-floor">
      <!-- Assets -->
      <a-assets>
        <img id="floor-model" src="assets/floor.png" />
        <img id="walls-model" src="assets/wall.png" />
        <img id="roof-model" src="assets/roof.jpg" />
        <img id="espresso-image" src="assets/espresso.png" />
        <img id="latte-image" src="assets/latte.png" />
        <a-asset-item id="counter-model" src="assets/table.glb" />
        <a-asset-item id="coffee-machine-model" src="assets/coffee-machine.glb" />
        <a-asset-item id="cup-model" src="assets/cup.glb" />
        <a-asset-item id="customer-model" src="assets/customer.glb" />
        <a-asset-item id="steam-wand-model" src="assets/steam-wand.glb" />
        <a-asset-item id="latte-model" src="assets/latte.glb" />
      </a-assets>
      
      <!-- Mixins -->
      <a-mixin id="wall"
        geometry="primitive: plane;
                  width: 6; height: 6"
        material="src: #walls-model; color: #ffe388; side: double">
      </a-mixin>

      <!-- Camera + cursor -->
      <a-entity id="rig" position="-0.5 0 0">
        <a-camera id="camera" look-controls position="0 1 0" wasd-controls-enabled="false">
          <a-cursor cursor-complementary-color raycaster="objects: .clickable" fuse-logger fuse="true" fuseTimeout="1000" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;" material="color: black; shader: flat"
            animation__fusing="property: geometry.thetaLength; from: 0; to: 360; dur: 1500; startEvents: fusing;"
            animation__reset="property: geometry.thetaLength; from: 360; to: 360; dur: 1; startEvents: mouseleave;"
          >
          </a-cursor>
        </a-camera>

        <!-- Hands -->
        <a-entity id="left-hand"
          hand-controls="hand: left; controller: 0; handModelStyle: highPoly"
          physics-collider
          super-hands
          sphere-collider="objects: .grabbable">
        </a-entity>
        <a-entity id="right-hand"
          sound="src:url(assets/pop.mp3); positional: false"
          hand-controls="hand: right; controller: 1; handModelStyle: highPoly"
          physics-collider
          super-hands
          sphere-collider="objects: .grabbable">
        </a-entity>
      </a-entity>

      <!-- Floor -->
      <a-plane 
        src="#floor-model"
        width="6" height="6"
        color="#aaaaaa"
        position="0 0 0" rotation="-90 0 0"
      >
      </a-plane>
      <a-plane 
        src="#floor-model"
        width="6" height="6"
        color="#aaaaaa"
        position="0 0 -6" rotation="-90 0 0"
      >
      </a-plane>

      <!-- Roof -->
      <a-plane 
        width="6" height="6"
        src="#roof-model"
        position="0 4 0" rotation="90 0 0"
      >
      </a-plane>
      <a-plane 
        width="6" height="6"
        src="#roof-model"
        position="0 4 -6" rotation="90 0 0"
      >
      </a-plane>

      <!-- Walls -->
      <a-entity mixin="wall"
        position="3 1.5 0" rotation="0 -90 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="0 1.5 3" rotation="0 180 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="-3 1.5 0" rotation="0 90 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="0 1.5 -3" rotation="0 0 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="3 1.5 -6" rotation="0 -90 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="-3 1.5 -6" rotation="0 90 0"
      >
      </a-entity>
      <a-entity mixin="wall"
        position="0 1.5 -9" rotation="0 0 0"
      >
      </a-entity>

      <a-box id="counter"
        width="2.5" height="1" depth="0.8"
        color="#692008" opacity="0"
        position="0 0 -1.5" scale="0.7 0.5 0.5">
        <a-entity gltf-model="#counter-model"></a-entity>
      </a-box>

      <a-box
        id="coffee-machine"
        sound="src:url(assets/pop.mp3); positional: false;"
        width="0.5" height="0.8" depth="0.4"
        color="#111111" opacity="0"
        position="-0.7 0 -1.5"
        fuse-handler="#brew-button"
        animation="property: rotation;
                  from: 0 0 0; to: 0 5 0; dur: 250;
                  startEvents: click; pauseEvents: mouseleave;
                  elasticity: 1000;
                  loop: true; dir: alternate; easing: easeInSine">
          <a-entity class="clickable"
                    gltf-model="#coffee-machine-model"
                    position="0 0.5 0"
                    scale="0.008 0.008 0.008">
          </a-entity>
      </a-box>

      <a-box
        id="brew-button" class="clickable"
        sound="src:url(assets/coffee-machine.mp3); positional: false;"
        visible="false"
        width="0.5" height="0.2" depth="0.05"
        position="-0.7 1.5 -1.25"
        animation__fusing="property: position;
                          from: -0.7 1.5 -1.25; to: -0.7 1.55 -1.25;
                          startEvents: fusing; pauseEvents: mouseleave;
                          loop: true; dir: alternate"
         brew-button-clicked>

        <a-text value="Brew"
                color="#000000" align="center"
                position="0 0 0.06"
                width="4">
        </a-text>
      </a-box>

      <a-box id="espresso-shot"
        visible="false" opacity="0"
        width="0.2" height="0.3" depth="0.2"
        position="0 0.58 -1.5" scale="0.25 0.25 0.25" rotation="0 -90 0"
        grabbable
        raycaster="objects: .detectable; direction: 0 0 -1"
        coffee="espresso">
        <a-entity gltf-model="#cup-model" class="grabbable"></a-entity>
      </a-box>


      <a-box id="latte"
        visible="false" opacity="0"
        width="0.2" height="0.3" depth="0.2"
        position="1.5 0.58 -0.65" scale="0.25 0.25 0.25" rotation="0 0 0"
        grabbable
        raycaster="objects: .detectable; direction: 0 0 -1"
        coffee="latte">
        <a-entity gltf-model="#latte-model" class="grabbable"></a-entity>
      </a-box>

      <a-entity id="customers">
        <a-cylinder
          sound="src: url(assets/cashier.mp3); positional: false"
          visible="true" color="#977575"
          material="opacity: 0;"
          radius="0.3"
          height="6"
          position="0.2 0 -2.5" scale="0.5 0.5 0.5"
          customer-order>
          <a-entity gltf-model="#customer-model" animation-mixer="clip: Idle;">
            <a-box
              position="0 3.5 0"
              width="1" height="1" depth="0.01"
              color="#cccccc"
              src="#espresso-image" />
            </a-box>
          </a-entity>
        </a-cylinder>
      </a-entity>

      <a-box id="play-music" class="clickable"
        position="-2 2 -2"
        width="0.5" height="0.5" depth="0.05"
        sound="src:url(assets/music.mp3); loop: true; positional: false;"
        play-music>
        <a-text value="Music:\nOff"
                color="black" align="center"
                position="0 0 0.06"
                width="3">
        </a-text>
      </a-box>

      <a-box id="shop" class="clickable" shop
        sound="src:url(assets/pop.mp3); positional: false;"
        position="-2 1.45 -2"
        width="0.5" height="0.5" depth="0.05">
        <a-text value="Shop"
                color="black" align="center"
                position="0 0 0.06"
                width="3">
        </a-text>
      </a-box>

      <a-box id="tutorial-button" class="clickable"
        position="-2 0.90 -2"
        width="0.5" height="0.5" depth="0.05"
        sound="src:url(assets/pop.mp3); positional: false;"
        tutorial>
        <a-text value="Tutorial"
                color="black" align="center"
                position="0 0 0.06"
                width="3">
        </a-text>
      </a-box>

      <a-box id="tutorial"
        visible="false" class="clickable"
        position="0 0.7 -0.5"
        width="2" height="0.3" depth="0.01">
        <a-text align="right"
          position="0 0.05 0.06"
          color="black"
          width="1"
          value=""></a-text>
      </a-box>

      <!-- Shop Items -->
      <a-entity id="shopItems"></a-entity>

      <a-cone id="back-button" class="clickable"
        position="-2 2 -8" rotation="0 0 90"
        sound="src:url(assets/pop.mp3); positional: false;"
        radius-bottom="0.08" radius-top="0.001" height="0.4"
        color="#00ff00" back-button>
        <a-cylinder position="0 -0.4 0" radius="0.04" height="0.4" color="#00ff00" />
      </a-cone>

      <a-box id="shopCounter"
        width="2.5" height="1" depth="0.8"
        color="#692008" opacity="0"
        position="0 0 -7.5" scale="0.7 0.5 0.5">
        <a-entity gltf-model="#counter-model"></a-entity>
      </a-box>

      <a-text position="0 1.2 -7.5" align="center"
              value="$10"
              color="#00ff00"
              side="double"
              width="10"
              look-controls>
        <a-box id="counterBuy" class="clickable"
          position="0 -0.4 0"
          width="0.7" height="0.3" depth="0.05"
          sound="src:url(assets/cashier.mp3); positional: false;"
          buy price="10">
          <a-text value="BUY"
                color="#000000" align="center"
                position="0 0 0.06"
                width="3">
          </a-text>
        </a-box>
      </a-text>

      <a-text position="1.75 1.85 -7.5" align="center"
              value="$10"
              color="#00ff00"
              side="double"
              width="10"
              look-controls>
        <a-box id="steamWandBuy" class="clickable"
          position="0 -0.4 0"
          width="0.7" height="0.3" depth="0.05"
          sound="src:url(assets/cashier.mp3); positional: false;"
          buy price="10">
          <a-text value="BUY"
                color="#000000" align="center"
                position="0 0 0.06"
                width="3">
          </a-text>
        </a-box>
      </a-text>

      <a-box id="shopSteamWand"
        width="1" height="1" depth="1"
        color="#692008" opacity="0"
        position="1.75 1 -7.5" scale="0.07 0.07 0.07">
        <a-entity gltf-model="#steam-wand-model"></a-entity>
      </a-box>

      <a-sky color="aqua"></a-sky>
    </a-scene>
  </body>
</html>